<!DOCTYPE html>â€¨<html lang="es" data-theme="dark">â€¨<head>â€¨Â  <meta charset="UTF-8" />â€¨Â  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />â€¨Â  <title>Mi Control Financiero</title>â€¨Â  <meta name="theme-color" content="#121212" />â€¨Â  <link rel="manifest" href="/manifest.json" />â€¨Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLp3iJ1x20A6u+f5t1z+1e5KzI9I6n0F5/x8i9G9b2h9m8V5l7l2v7y7k5C5" crossorigin="anonymous" referrerpolicy="no-referrer" />â€¨â€¨Â  <!-- ==================================================================================== -->â€¨Â  <!-- ===================================== CSS ========================================== -->â€¨Â  <!-- ==================================================================================== -->â€¨Â  <style>â€¨Â  Â  /* ====== VARIABLES DE TEMA ====== */â€¨Â  Â  :root {â€¨Â  Â  Â  --bg-color: #0f0f10;â€¨Â  Â  Â  --card-bg: #121212;â€¨Â  Â  Â  --card-border: #232323;â€¨Â  Â  Â  --text-color: #f1f1f1;â€¨Â  Â  Â  --text-light: #a9a9a9;â€¨Â  Â  Â  --input-bg: #171717;â€¨Â  Â  Â  --input-border: #242424;â€¨Â  Â  Â  --primary-btn-bg: #2b7cff;â€¨Â  Â  Â  --secondary-btn-bg: #202020;â€¨Â  Â  Â  --secondary-btn-border: #2d2d2d;â€¨Â  Â  Â  --border-soft: #1f1f1f;â€¨Â  Â  Â  --header-bg: #161616;â€¨Â  Â  Â  --accent-green: #66bb6a;â€¨Â  Â  Â  --accent-red: #ef5350;â€¨Â  Â  Â  --accent-blue: #4fc3f7;â€¨Â  Â  }â€¨â€¨Â  Â  [data-theme="light"] {â€¨Â  Â  Â  --bg-color: #f0f2f5;â€¨Â  Â  Â  --card-bg: #ffffff;â€¨Â  Â  Â  --card-border: #e0e0e0;â€¨Â  Â  Â  --text-color: #333333;â€¨Â  Â  Â  --text-light: #666666;â€¨Â  Â  Â  --input-bg: #f9f9f9;â€¨Â  Â  Â  --input-border: #e0e0e0;â€¨Â  Â  Â  --primary-btn-bg: #1e88e5;â€¨Â  Â  Â  --secondary-btn-bg: #e0e0e0;â€¨Â  Â  Â  --secondary-btn-border: #bdbdbd;â€¨Â  Â  Â  --border-soft: #e9e9e9;â€¨Â  Â  Â  --header-bg: #f5f5f5;â€¨Â  Â  Â  --accent-green: #2e7d32;â€¨Â  Â  Â  --accent-red: #c62828;â€¨Â  Â  Â  --accent-blue: #0277bd;â€¨Â  Â  }â€¨â€¨Â  Â  /* ====== RESET & BASE ====== */â€¨Â  Â  * { box-sizing: border-box; }â€¨Â  Â  html, body { height: 100%; }â€¨Â  Â  body {â€¨Â  Â  Â  margin: 0;â€¨Â  Â  Â  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;â€¨Â  Â  Â  background: var(--bg-color);â€¨Â  Â  Â  color: var(--text-color);â€¨Â  Â  Â  display: flex;â€¨Â  Â  Â  flex-direction: column;â€¨Â  Â  Â  align-items: center;â€¨Â  Â  Â  gap: 16px;â€¨Â  Â  Â  padding: 16px;â€¨Â  Â  Â  overflow-x: hidden;â€¨Â  Â  Â  position: relative;â€¨Â  Â  }â€¨â€¨Â  Â  h1 {â€¨Â  Â  Â  margin: 0;â€¨Â  Â  Â  font-size: 22px;â€¨Â  Â  Â  letter-spacing: .2px;â€¨Â  Â  Â  color: var(--text-color);â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  .theme-switcher {â€¨Â  Â  Â  position: absolute;â€¨Â  Â  Â  top: 16px;â€¨Â  Â  Â  right: 16px;â€¨Â  Â  Â  font-size: 24px;â€¨Â  Â  Â  background: none;â€¨Â  Â  Â  border: none;â€¨Â  Â  Â  color: var(--text-light);â€¨Â  Â  Â  cursor: pointer;â€¨Â  Â  Â  line-height: 1;â€¨Â  Â  }â€¨â€¨Â  Â  /* ====== PANEL SUPERIOR ====== */â€¨Â  Â  .panel {â€¨Â  Â  Â  width: 100%;â€¨Â  Â  Â  max-width: 560px;â€¨Â  Â  Â  background: var(--card-bg);â€¨Â  Â  Â  border: 1px solid var(--card-border);â€¨Â  Â  Â  border-radius: 16px;â€¨Â  Â  Â  padding: 14px;â€¨Â  Â  Â  box-shadow: 0 10px 30px rgba(0,0,0,.15);â€¨Â  Â  Â  transition: opacity 0.3s ease;â€¨Â  Â  }â€¨â€¨Â  Â  .panel.hidden {â€¨Â  Â  Â  opacity: 0;â€¨Â  Â  Â  height: 0;â€¨Â  Â  Â  padding: 0;â€¨Â  Â  Â  margin: 0;â€¨Â  Â  Â  border: none;â€¨Â  Â  }â€¨â€¨Â  Â  .metrics {â€¨Â  Â  Â  display: grid;â€¨Â  Â  Â  grid-template-columns: repeat(3, minmax(0, 1fr));â€¨Â  Â  Â  gap: 8px;â€¨Â  Â  Â  align-items: stretch;â€¨Â  Â  }â€¨â€¨Â  Â  .metric {â€¨Â  Â  Â  background: var(--input-bg);â€¨Â  Â  Â  border: 1px solid var(--input-border);â€¨Â  Â  Â  border-radius: 12px;â€¨Â  Â  Â  padding: 10px 8px;â€¨Â  Â  Â  text-align: center;â€¨Â  Â  }â€¨Â  Â  .metric .label {â€¨Â  Â  Â  font-size: 12px;â€¨Â  Â  Â  color: var(--text-light);â€¨Â  Â  Â  margin-bottom: 6px;â€¨Â  Â  Â  text-transform: uppercase;â€¨Â  Â  Â  letter-spacing: .6px;â€¨Â  Â  }â€¨Â  Â  .metric .value {â€¨Â  Â  Â  font-weight: 700;â€¨Â  Â  Â  font-size: clamp(16px, 4.3vw, 20px);â€¨Â  Â  }â€¨Â  Â  .metric.ahorro .value { color: var(--accent-blue); }â€¨Â  Â  .metric.saldoÂ  .value { color: var(--accent-green); }â€¨Â  Â  .metric.gastos .value { color: var(--accent-red); }â€¨â€¨Â  Â  /* ====== PANTALLAS Y FORMULARIOS ====== */â€¨Â  Â  .screen {â€¨Â  Â  Â  width: 100%;â€¨Â  Â  Â  max-width: 560px;â€¨Â  Â  Â  display: none;â€¨Â  Â  Â  flex-direction: column;â€¨Â  Â  Â  align-items: center;â€¨Â  Â  Â  gap: 16px;â€¨Â  Â  Â  overflow-y: auto;â€¨Â  Â  }â€¨Â  Â  .screen.active {â€¨Â  Â  Â  display: flex;â€¨Â  Â  }â€¨â€¨Â  Â  .input-area {â€¨Â  Â  Â  width: 100%;â€¨Â  Â  Â  display: grid;â€¨Â  Â  Â  grid-template-columns: 1fr 1fr auto;â€¨Â  Â  Â  gap: 10px;â€¨Â  Â  }â€¨Â  Â  .input-area input,â€¨Â  Â  .input-area select,â€¨Â  Â  .btn {â€¨Â  Â  Â  border: 1px solid var(--input-border);â€¨Â  Â  Â  background: var(--input-bg);â€¨Â  Â  Â  color: var(--text-color);â€¨Â  Â  Â  border-radius: 12px;â€¨Â  Â  Â  padding: 12px 12px;â€¨Â  Â  Â  font-size: 16px;â€¨Â  Â  Â  outline: none;â€¨Â  Â  Â  -webkit-appearance: none;â€¨Â  Â  Â  -moz-appearance: none;â€¨Â  Â  Â  appearance: none;â€¨Â  Â  }â€¨Â  Â  .input-area select {â€¨Â  Â  Â  padding-right: 30px;â€¨Â  Â  Â  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down" style="color: %23a9a9a9;"><polyline points="6 9 12 15 18 9"></polyline></svg>');â€¨Â  Â  Â  background-repeat: no-repeat;â€¨Â  Â  Â  background-position: right 10px center;â€¨Â  Â  Â  background-size: 18px;â€¨Â  Â  }â€¨Â  Â  [data-theme="light"] .input-area select {â€¨Â  Â  Â  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down" style="color: %23666666;"><polyline points="6 9 12 15 18 9"></polyline></svg>');â€¨Â  Â  }â€¨Â  Â  .btn {â€¨Â  Â  Â  cursor: pointer;â€¨Â  Â  Â  font-weight: 600;â€¨Â  Â  Â  transition: transform .06s ease, background .2s ease;â€¨Â  Â  Â  background: var(--primary-btn-bg);â€¨Â  Â  Â  border-color: var(--primary-btn-bg);â€¨Â  Â  }â€¨Â  Â  .btn:active { transform: translateY(1px); }â€¨Â  Â  .btn.secundario {â€¨Â  Â  Â  background: var(--secondary-btn-bg);â€¨Â  Â  Â  border-color: var(--secondary-btn-border);â€¨Â  Â  }â€¨Â  Â  .btn.secundario:hover { background: var(--secondary-btn-bg); }â€¨â€¨Â  Â  .actions {â€¨Â  Â  Â  width: 100%;â€¨Â  Â  Â  display: flex;â€¨Â  Â  Â  gap: 10px;â€¨Â  Â  Â  margin-top: -8px;â€¨Â  Â  }â€¨Â  Â  .actions .btn { flex: 1; }â€¨Â  Â  â€¨Â  Â  /* ====== PANTALLA DE MANDADO ====== */â€¨Â  Â  #mandado-screen header, #mandado-historial-screen header, #mandado-detalle-screen header, #deudas-screen header {â€¨Â  Â  Â  width: 100%;â€¨Â  Â  Â  max-width: 560px;â€¨Â  Â  Â  display: flex;â€¨Â  Â  Â  justify-content: space-between;â€¨Â  Â  Â  align-items: center;â€¨Â  Â  }â€¨â€¨Â  Â  /* ====== HISTORIAL & GRAFICO ====== */â€¨Â  Â  #historial {â€¨Â  Â  Â  width: 100%;â€¨Â  Â  Â  max-width: 560px;â€¨Â  Â  Â  display: none;â€¨Â  Â  Â  background: var(--card-bg);â€¨Â  Â  Â  border: 1px solid var(--card-border);â€¨Â  Â  Â  border-radius: 14px;â€¨Â  Â  Â  margin-top: 10px;â€¨Â  Â  }â€¨Â  Â  #historial header {â€¨Â  Â  Â  display: flex;â€¨Â  Â  Â  justify-content: space-between;â€¨Â  Â  Â  align-items: center;â€¨Â  Â  Â  padding: 12px 14px;â€¨Â  Â  Â  border-bottom: 1px solid var(--card-border);â€¨Â  Â  Â  font-weight: 700;â€¨Â  Â  Â  font-size: 15px;â€¨Â  Â  Â  background: var(--header-bg);â€¨Â  Â  Â  border-top-left-radius: 14px;â€¨Â  Â  Â  border-top-right-radius: 14px;â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  .tabs {â€¨Â  Â  Â  display: flex;â€¨Â  Â  Â  gap: 8px;â€¨Â  Â  Â  font-size: 14px;â€¨Â  Â  Â  font-weight: 500;â€¨Â  Â  Â  flex-wrap: wrap; /* Permite que los tabs se envuelvan en pantallas pequeÃ±as */â€¨Â  Â  }â€¨Â  Â  .tab {â€¨Â  Â  Â  padding: 6px 10px;â€¨Â  Â  Â  border-radius: 8px;â€¨Â  Â  Â  cursor: pointer;â€¨Â  Â  Â  background: var(--secondary-btn-bg);â€¨Â  Â  }â€¨Â  Â  .tab.active {â€¨Â  Â  Â  background: var(--primary-btn-bg);â€¨Â  Â  Â  color: white;â€¨Â  Â  }â€¨â€¨Â  Â  .historial-content {â€¨Â  Â  Â  padding: 0;â€¨Â  Â  }â€¨Â  Â  .semana, .mes {â€¨Â  Â  Â  padding: 10px 14px 2px;â€¨Â  Â  Â  border-bottom: 1px dashed var(--card-border);â€¨Â  Â  }â€¨Â  Â  .semana .rango, .mes .rango {â€¨Â  Â  Â  font-size: 12px;â€¨Â  Â  Â  color: var(--text-light);â€¨Â  Â  Â  margin-bottom: 8px;â€¨Â  Â  }â€¨Â  Â  .registro {â€¨Â  Â  Â  display: grid;â€¨Â  Â  Â  grid-template-columns: auto 1fr auto auto;â€¨Â  Â  Â  gap: 6px;â€¨Â  Â  Â  padding: 8px 0;â€¨Â  Â  Â  border-bottom: 1px solid var(--border-soft);â€¨Â  Â  Â  font-size: 14px;â€¨Â  Â  Â  align-items: center;â€¨Â  Â  }â€¨Â  Â  .registro:last-child { border-bottom: none; }â€¨Â  Â  .registro .tipo {â€¨Â  Â  Â  color: var(--text-color);â€¨Â  Â  Â  font-weight: 600;â€¨Â  Â  Â  display: flex;â€¨Â  Â  Â  align-items: center;â€¨Â  Â  }â€¨Â  Â  .registro .tipo .icono {â€¨Â  Â  Â  margin-right: 6px;â€¨Â  Â  Â  font-size: 1.2em;â€¨Â  Â  }â€¨Â  Â  .registro .monto {â€¨Â  Â  Â  justify-self: end;â€¨Â  Â  Â  font-weight: 600;â€¨Â  Â  }â€¨Â  Â  .registro .delete-btn {â€¨Â  Â  Â  background: none;â€¨Â  Â  Â  border: none;â€¨Â  Â  Â  color: var(--accent-red);â€¨Â  Â  Â  font-size: 18px;â€¨Â  Â  Â  cursor: pointer;â€¨Â  Â  Â  padding: 0;â€¨Â  Â  Â  margin-left: 8px;â€¨Â  Â  }â€¨Â  Â  .registro .fecha {â€¨Â  Â  Â  color: var(--text-light);â€¨Â  Â  Â  font-size: 12px;â€¨Â  Â  Â  grid-column: 1 / -1;â€¨Â  Â  Â  text-align: right;â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  /* ====== GRAFICOS ====== */â€¨Â  Â  .chart-container {â€¨Â  Â  Â  padding: 16px 14px;â€¨Â  Â  Â  background: var(--card-bg);â€¨Â  Â  Â  display: none;â€¨Â  Â  Â  border-bottom-left-radius: 14px;â€¨Â  Â  Â  border-bottom-right-radius: 14px;â€¨Â  Â  Â  border: 1px solid var(--card-border);â€¨Â  Â  Â  border-top: none;â€¨Â  Â  }â€¨Â  Â  .chart-container h3 {â€¨Â  Â  Â  margin: 0 0 10px;â€¨Â  Â  Â  font-size: 16px;â€¨Â  Â  Â  color: var(--text-color);â€¨Â  Â  }â€¨Â  Â  .chart {â€¨Â  Â  Â  width: 100%;â€¨Â  Â  Â  height: 250px;â€¨Â  Â  Â  max-width: 350px;â€¨Â  Â  Â  margin: auto;â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  /* ====== PANTALLA DE DEUDAS ====== */â€¨Â  Â  #deudas-screen {â€¨Â  Â  Â  Â  gap: 10px;â€¨Â  Â  }â€¨Â  Â  #deudas-lista {â€¨Â  Â  Â  Â  list-style: none;â€¨Â  Â  Â  Â  padding: 0;â€¨Â  Â  Â  Â  width: 100%;â€¨Â  Â  Â  Â  margin: 0;â€¨Â  Â  }â€¨Â  Â  #deudas-lista li {â€¨Â  Â  Â  Â  background: var(--card-bg);â€¨Â  Â  Â  Â  border: 1px solid var(--card-border);â€¨Â  Â  Â  Â  border-radius: 12px;â€¨Â  Â  Â  Â  padding: 12px 16px;â€¨Â  Â  Â  Â  margin-bottom: 10px;â€¨Â  Â  }â€¨Â  Â  #deudas-lista li h3 {â€¨Â  Â  Â  Â  margin: 0 0 8px;â€¨Â  Â  Â  Â  font-size: 18px;â€¨Â  Â  Â  Â  color: var(--primary-btn-bg);â€¨Â  Â  }â€¨Â  Â  #deudas-lista li .info {â€¨Â  Â  Â  Â  display: flex;â€¨Â  Â  Â  Â  justify-content: space-between;â€¨Â  Â  Â  Â  font-size: 14px;â€¨Â  Â  Â  Â  color: var(--text-light);â€¨Â  Â  }â€¨Â  Â  #deudas-lista li .monto-total,â€¨Â  Â  #deudas-lista li .monto-restante {â€¨Â  Â  Â  Â  font-size: 16px;â€¨Â  Â  Â  Â  font-weight: bold;â€¨Â  Â  }â€¨Â  Â  #deudas-lista li .monto-restante {â€¨Â  Â  Â  Â  color: var(--accent-red);â€¨Â  Â  }â€¨Â  Â  .deuda-actions {â€¨Â  Â  Â  Â  display: flex;â€¨Â  Â  Â  Â  justify-content: flex-end;â€¨Â  Â  Â  Â  gap: 8px;â€¨Â  Â  Â  Â  margin-top: 12px;â€¨Â  Â  }â€¨Â  Â  .deuda-actions .btn {â€¨Â  Â  Â  Â  padding: 6px 12px;â€¨Â  Â  Â  Â  font-size: 14px;â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  .modal {â€¨Â  Â  Â  Â  display: none;â€¨Â  Â  Â  Â  position: fixed;â€¨Â  Â  Â  Â  z-index: 1000;â€¨Â  Â  Â  Â  left: 0;â€¨Â  Â  Â  Â  top: 0;â€¨Â  Â  Â  Â  width: 100%;â€¨Â  Â  Â  Â  height: 100%;â€¨Â  Â  Â  Â  overflow: auto;â€¨Â  Â  Â  Â  background-color: rgba(0,0,0,0.4);â€¨Â  Â  Â  Â  padding-top: 60px;â€¨Â  Â  }â€¨Â  Â  .modal-content {â€¨Â  Â  Â  Â  background-color: var(--card-bg);â€¨Â  Â  Â  Â  margin: 5% auto;â€¨Â  Â  Â  Â  padding: 20px;â€¨Â  Â  Â  Â  border: 1px solid var(--card-border);â€¨Â  Â  Â  Â  border-radius: 16px;â€¨Â  Â  Â  Â  width: 90%;â€¨Â  Â  Â  Â  max-width: 400px;â€¨Â  Â  Â  Â  animation: fadeIn 0.3s;â€¨Â  Â  }â€¨Â  Â  @keyframes fadeIn {â€¨Â  Â  Â  Â  from { opacity: 0; transform: translateY(-20px); }â€¨Â  Â  Â  Â  to { opacity: 1; transform: translateY(0); }â€¨Â  Â  }â€¨Â  Â  .modal-content h3 {â€¨Â  Â  Â  Â  margin-top: 0;â€¨Â  Â  Â  Â  text-align: center;â€¨Â  Â  }â€¨Â  Â  .modal-content input, .modal-content select {â€¨Â  Â  Â  Â  width: 100%;â€¨Â  Â  Â  Â  margin-bottom: 10px;â€¨Â  Â  }â€¨â€¨Â  Â  /* ====== Notificacion ====== */â€¨Â  Â  #notificacion {â€¨Â  Â  Â  position: fixed;â€¨Â  Â  Â  bottom: 20px;â€¨Â  Â  Â  left: 50%;â€¨Â  Â  Â  transform: translateX(-50%);â€¨Â  Â  Â  background-color: var(--primary-btn-bg);â€¨Â  Â  Â  color: white;â€¨Â  Â  Â  padding: 12px 20px;â€¨Â  Â  Â  border-radius: 8px;â€¨Â  Â  Â  z-index: 1000;â€¨Â  Â  Â  display: none;â€¨Â  Â  Â  box-shadow: 0 4px 12px rgba(0,0,0,0.3);â€¨Â  Â  Â  font-size: 15px;â€¨Â  Â  Â  font-weight: 600;â€¨Â  Â  Â  white-space: nowrap;â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  @media (max-width: 500px) {â€¨Â  Â  Â  .input-area { â€¨Â  Â  Â  Â  grid-template-columns: 1fr;â€¨Â  Â  Â  Â  gap: 8px;â€¨Â  Â  Â  }â€¨Â  Â  Â  .input-area button {â€¨Â  Â  Â  Â  width: 100%;â€¨Â  Â  Â  }â€¨Â  Â  Â  .registro { grid-template-columns: 1fr 1fr auto auto; }â€¨Â  Â  Â  .registro .fecha { grid-column: auto; text-align: left; margin-top: 4px; }â€¨Â  Â  Â  #mandado-screen .input-item { grid-template-columns: 1fr; }â€¨Â  Â  }â€¨Â  </style>â€¨</head>â€¨<body>â€¨Â  <!-- ==================================================================================== -->â€¨Â  <!-- =============================== ESTRUCTURA HTML ==================================== -->â€¨Â  <!-- ==================================================================================== -->â€¨â€¨Â  <h1>ğŸ’° Mi Control Financiero</h1>â€¨Â  <button id="theme-switcher" class="theme-switcher">â˜€ï¸</button>â€¨â€¨Â  <!-- Panel principal de saldos -->â€¨Â  <section id="main-panel" class="panel">â€¨Â  Â  <div class="metrics">â€¨Â  Â  Â  <div class="metric ahorro">â€¨Â  Â  Â  Â  <div class="label">Ahorro</div>â€¨Â  Â  Â  Â  <div id="ahorro" class="value">$0.00</div>â€¨Â  Â  Â  </div>â€¨Â  Â  Â  <div class="metric saldo">â€¨Â  Â  Â  Â  <div class="label">Saldo total</div>â€¨Â  Â  Â  Â  <div id="saldo" class="value">$0.00</div>â€¨Â  Â  Â  </div>â€¨Â  Â  Â  <div class="metric gastos">â€¨Â  Â  Â  Â  <div class="label">Gastos</div>â€¨Â  Â  Â  Â  <div id="gastos" class="value">$0.00</div>â€¨Â  Â  Â  </div>â€¨Â  Â  </div>â€¨Â  </section>â€¨â€¨Â  <!-- Pantalla principal -->â€¨Â  <div id="main-screen" class="screen active">â€¨Â  Â  Â  <!-- Formulario principal -->â€¨Â  Â  Â  <section class="input-area">â€¨Â  Â  Â  Â  <input type="number" id="monto" placeholder="Monto (ej. 2000, -200 para retirar de Ahorro)" />â€¨Â  Â  Â  Â  <select id="tipo">â€¨Â  Â  Â  Â  Â  <option value="Sueldo">Sueldo</option>â€¨Â  Â  Â  Â  Â  <option value="Ahorro">Ahorro</option>â€¨Â  Â  Â  Â  Â  <option value="Mandado">Mandado</option>â€¨Â  Â  Â  Â  Â  <option value="Efectivo">Efectivo</option>â€¨Â  Â  Â  Â  Â  <option value="Telmex">Telmex</option>â€¨Â  Â  Â  Â  Â  <option value="CFE">CFE</option>â€¨Â  Â  Â  Â  Â  <option value="Tienda">Tienda</option>â€¨Â  Â  Â  Â  Â  <option value="Corning">Corning</option>â€¨Â  Â  Â  Â  Â  <option value="Didi">Didi</option>â€¨Â  Â  Â  Â  Â  <option value="iCloud">iCloud</option>â€¨Â  Â  Â  Â  Â  <option value="Coppel">Coppel</option>â€¨Â  Â  Â  Â  Â  <option value="Otros">Otros</option>â€¨Â  Â  Â  Â  Â  <option value="PrÃ©stamo">PrÃ©stamo</option>â€¨Â  Â  Â  Â  </select>â€¨Â  Â  Â  Â  <button class="btn" id="btn-confirmar">Confirmar</button>â€¨Â  Â  Â  </section>â€¨â€¨Â  Â  Â  <section class="actions">â€¨Â  Â  Â  Â  <button class="btn secundario" id="btn-historial">ğŸ“œ Ver historial y anÃ¡lisis</button>â€¨Â  Â  Â  Â  <button class="btn secundario" id="btn-mandado">ğŸ›’ Ir al Mandado</button>â€¨Â  Â  Â  </section>â€¨Â  Â  Â  <section class="actions">â€¨Â  Â  Â  Â  <button class="btn secundario" id="btn-deudas">ğŸ’³ Deudas</button>â€¨Â  Â  Â  </section>â€¨â€¨â€¨Â  Â  Â  <!-- Historial y GrÃ¡fico -->â€¨Â  Â  Â  <section id="historial">â€¨Â  Â  Â  Â  <header>â€¨Â  Â  Â  Â  Â  Historialâ€¨Â  Â  Â  Â  Â  <div class="tabs">â€¨Â  Â  Â  Â  Â  Â  Â  <div class="tab active" data-view="semana">Semanal</div>â€¨Â  Â  Â  Â  Â  Â  Â  <div class="tab" data-view="mes">Mensual</div>â€¨Â  Â  Â  Â  Â  Â  Â  <div class="tab" data-view="analisis-gastos">AnÃ¡lisis</div>â€¨Â  Â  Â  Â  Â  Â  Â  <div class="tab" data-view="analisis-tendencia">Tendencia</div>â€¨Â  Â  Â  Â  Â  </div>â€¨Â  Â  Â  Â  </header>â€¨Â  Â  Â  Â  <div id="contenedorSemanas" class="historial-content"></div>â€¨Â  Â  Â  Â  <div id="contenedorMeses" class="historial-content" style="display: none;"></div>â€¨Â  Â  Â  Â  <div id="chart-pie-container" class="chart-container" style="display: none;">â€¨Â  Â  Â  Â  Â  Â  <h3>DistribuciÃ³n de Gastos</h3>â€¨Â  Â  Â  Â  Â  Â  <canvas id="chart-pie" class="chart"></canvas>â€¨Â  Â  Â  Â  </div>â€¨Â  Â  Â  Â  <div id="chart-line-container" class="chart-container" style="display: none;">â€¨Â  Â  Â  Â  Â  Â  <h3>Tendencia de Gastos</h3>â€¨Â  Â  Â  Â  Â  Â  <canvas id="chart-line" class="chart"></canvas>â€¨Â  Â  Â  Â  </div>â€¨Â  Â  Â  </section>â€¨Â  </div>â€¨Â  â€¨Â  <!-- Pantalla para Mandado (inicialmente oculta) -->â€¨Â  <section id="mandado-screen" class="screen">â€¨Â  Â  Â  <header>â€¨Â  Â  Â  Â  Â  <h2>Ticket del Mandado</h2>â€¨Â  Â  Â  Â  Â  <button class="btn secundario" id="btn-volver-mandado">Volver</button>â€¨Â  Â  Â  </header>â€¨Â  Â  Â  â€¨Â  Â  Â  <div class="input-item">â€¨Â  Â  Â  Â  Â  <select id="mandado-categoria">â€¨Â  Â  Â  Â  Â  Â  Â  <option value="">Selecciona CategorÃ­a</option>â€¨Â  Â  Â  Â  Â  Â  Â  <option value="Frutas y Verduras">Frutas y Verduras</option>â€¨Â  Â  Â  Â  Â  Â  Â  <option value="Abarrotes">Abarrotes</option>â€¨Â  Â  Â  Â  Â  Â  Â  <option value="Higiene Personal">Higiene Personal</option>â€¨Â  Â  Â  Â  Â  Â  Â  <option value="Carnes">Carnes</option>â€¨Â  Â  Â  Â  Â  Â  Â  <option value="Otros">Otros</option>â€¨Â  Â  Â  Â  Â  </select>â€¨Â  Â  Â  Â  Â  <select id="mandado-producto" style="display: none;"></select>â€¨Â  Â  Â  Â  Â  <input type="text" id="nombre-articulo" placeholder="Nombre del artÃ­culo" style="display: none;">â€¨â€¨Â  Â  Â  Â  Â  <div class="grid-inputs">â€¨Â  Â  Â  Â  Â  Â  Â  <input type="number" id="mandado-peso" placeholder="Peso (ej. 0.800 kg)" step="0.01" style="display: none;">â€¨Â  Â  Â  Â  Â  Â  Â  <input type="number" id="mandado-precio" placeholder="Precio (ej. 20.00 pz)" step="0.01" style="display: none;">â€¨Â  Â  Â  Â  Â  </div>â€¨Â  Â  Â  Â  Â  <button class="btn" id="btn-agregar-articulo" style="display: none;">â• Agregar</button>â€¨Â  Â  Â  </div>â€¨â€¨Â  Â  Â  <ul id="lista-mandado">â€¨Â  Â  Â  Â  Â  <!-- Los artÃ­culos se agregarÃ¡n aquÃ­ dinÃ¡micamente -->â€¨Â  Â  Â  </ul>â€¨â€¨Â  Â  Â  <div class="total-container">â€¨Â  Â  Â  Â  Â  <span>Total del ticket:</span>â€¨Â  Â  Â  Â  Â  <span class="valor" id="total-ticket">$0.00</span>â€¨Â  Â  Â  </div>â€¨â€¨Â  Â  Â  <button class="btn secundario" id="btn-historial-mandado">ğŸ§¾ Historial de mandados</button>â€¨Â  Â  Â  <button class="btn" id="btn-guardar-ticket">âœ… Guardar Ticket</button>â€¨Â  </section>â€¨â€¨Â  <!-- Pantalla de Historial de Mandados (oculta) -->â€¨Â  <section id="mandado-historial-screen" class="screen">â€¨Â  Â  <header>â€¨Â  Â  Â  <h2>Historial de Mandados</h2>â€¨Â  Â  Â  <button class="btn secundario" id="btn-volver-historial">Volver</button>â€¨Â  Â  </header>â€¨Â  Â  <ul id="mandado-historial-lista">â€¨Â  Â  Â  Â  <!-- Los tickets se cargarÃ¡n aquÃ­ -->â€¨Â  Â  </ul>â€¨Â  </section>â€¨â€¨Â  <!-- Pantalla de Detalle de Ticket (oculta) -->â€¨Â  <section id="mandado-detalle-screen" class="screen">â€¨Â  Â  <header>â€¨Â  Â  Â  <h2 id="detalle-titulo"></h2>â€¨Â  Â  Â  <button class="btn secundario" id="btn-volver-detalle">Volver</button>â€¨Â  Â  </header>â€¨Â  Â  <ul id="mandado-detalle-lista">â€¨Â  Â  Â  Â  <!-- Los detalles del ticket se cargarÃ¡n aquÃ­ -->â€¨Â  Â  </ul>â€¨Â  Â  <div class="total-container">â€¨Â  Â  Â  Â  <span>Total del ticket:</span>â€¨Â  Â  Â  Â  <span class="valor" id="detalle-total">$0.00</span>â€¨Â  Â  </div>â€¨Â  </section>â€¨Â  â€¨Â  <!-- Pantalla de Deudas -->â€¨Â  <section id="deudas-screen" class="screen">â€¨Â  Â  <header>â€¨Â  Â  Â  <h2>GestiÃ³n de Deudas</h2>â€¨Â  Â  Â  <button class="btn secundario" id="btn-volver-deudas">Volver</button>â€¨Â  Â  </header>â€¨Â  Â  <button class="btn" id="btn-agregar-deuda">â• Agregar Nueva Deuda</button>â€¨Â  Â  <ul id="deudas-lista">â€¨Â  Â  Â  <!-- Las deudas se cargarÃ¡n aquÃ­ dinÃ¡micamente -->â€¨Â  Â  </ul>â€¨Â  </section>â€¨Â  â€¨Â  <!-- Modal para agregar/pagar deuda -->â€¨Â  <div id="modal-deuda" class="modal">â€¨Â  Â  <div class="modal-content">â€¨Â  Â  Â  <h3 id="modal-titulo"></h3>â€¨Â  Â  Â  <input type="text" id="deuda-nombre" placeholder="Nombre de la deuda (ej. Coppel)" />â€¨Â  Â  Â  <input type="number" id="deuda-monto-total" placeholder="Monto total (ej. 5000)" />â€¨Â  Â  Â  <input type="number" id="deuda-monto-pago" placeholder="Monto del pago (opcional)" style="display: none;" />â€¨Â  Â  Â  <button class="btn" id="btn-guardar-deuda">Guardar</button>â€¨Â  Â  Â  <button class="btn secundario" id="btn-cerrar-modal">Cerrar</button>â€¨Â  Â  </div>â€¨Â  </div>â€¨â€¨Â  <!-- Notificacion de Ã©xito -->â€¨Â  <div id="notificacion" style="display: none;"></div>â€¨Â  â€¨Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>â€¨â€¨Â  <!-- ==================================================================================== -->â€¨Â  <!-- ================================= JAVASCRIPT ===================================== -->â€¨Â  <!-- ==================================================================================== -->â€¨â€¨Â  <script>â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: Variables y configuraciones globalesâ€¨Â  Â  // ====================================================================================â€¨Â  Â  const fmt = new Intl.NumberFormat("es-MX", { style: "currency", currency: "MXN" });â€¨Â  Â  const mesesLargos = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];â€¨Â  Â  const mesesCortos = ["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"];â€¨Â  Â  let myChartPie, myChartLine;â€¨Â  Â  let mandadoTicket = { items: [], total: 0 };â€¨Â  Â  let editIndex = null;â€¨â€¨Â  Â  const productosMandado = {â€¨Â  Â  Â  Â  "Frutas y Verduras": [â€¨Â  Â  Â  Â  Â  Â  "Aguacate", "Ajo", "Apio", "BrÃ³coli", "Calabaza", "Camote", "Cebolla", "Cebollin",â€¨Â  Â  Â  Â  Â  Â  "Chayote", "Chile habanero", "Chile jalapeÃ±o", "Chile Poblano", "Cilantro", "Ciruela",â€¨Â  Â  Â  Â  Â  Â  "Coco", "Durazno", "Ejotes", "Elotes", "Espinaca", "Fresas", "Germen de Soya", "Guayaba",â€¨Â  Â  Â  Â  Â  Â  "Jamaica", "Lechuga", "LimÃ³n", "Mango", "Manzanas", "Melon", "Naranjas", "Nopales",â€¨Â  Â  Â  Â  Â  Â  "Papa", "Papaya", "Pera", "PlÃ¡tano", "Repollo", "Sandia", "Tamarindo", "Tomate", "Tuna",â€¨Â  Â  Â  Â  Â  Â  "Uva", "Zacate de limÃ³n", "Zanahoria"â€¨Â  Â  Â  Â  ],â€¨Â  Â  Â  Â  "Abarrotes": [â€¨Â  Â  Â  Â  Â  Â  "Aceite", "Ajo en polvo", "Arroz", "Arroz con leche", "AtÃºn", "Avena", "Azucar", "AzÃºcar glass",â€¨Â  Â  Â  Â  Â  Â  "BBQ", "Bolillo", "Bolsa ziploc", "Cafe", "Canela", "Catsup", "Cereal", "Chile color",â€¨Â  Â  Â  Â  Â  Â  "Chiles en vinagre", "Chocomilk", "Clamato", "CÃ³ctel de frutas", "Comino", "Consomate",â€¨Â  Â  Â  Â  Â  Â  "Crema", "Cremora", "Cuernitos", "Elotitos", "Empanizador", "Flan", "Frijol", "Frijoles rancheros",â€¨Â  Â  Â  Â  Â  Â  "Granola", "Galletas", "Galletas saladas", "Harina", "Harina para hot cakes", "Harina para pastel",â€¨Â  Â  Â  Â  Â  Â  "Horchata", "Huevo", "Laurel", "Leche", "Leche carnation", "Lechera", "Lechitas", "Macarrones",â€¨Â  Â  Â  Â  Â  Â  "Maizena", "Mantequilla", "Maruchan", "Mayonesa", "Mermelada", "Mole", "Mostaza", "Nieve",â€¨Â  Â  Â  Â  Â  Â  "Pan blanco", "Pan dulce", "Pan para hamburguesa", "Pan para hotdog", "Pan tostado", "Papa congelada",â€¨Â  Â  Â  Â  Â  Â  "Papel de aluminio", "Pimienta", "PurÃ© de tomate", "PurÃ© huntz", "Queso amarillo", "Queso menonita",â€¨Â  Â  Â  Â  Â  Â  "Queso parmesano", "Queso Philadelphia", "Ranch", "Sal", "Sal con cebolla", "Salsa botanera",â€¨Â  Â  Â  Â  Â  Â  "Salsa picante", "Sazonador", "Servitoallas", "Sopa de coditos", "Spaguetti", "Tamarindo",â€¨Â  Â  Â  Â  Â  Â  "Te de manzanilla", "Tortilla amarilla", "Tortillas de harina", "Tostadas", "Yakult", "Yogurth",â€¨Â  Â  Â  Â  Â  Â  "Zukos"â€¨Â  Â  Â  Â  ],â€¨Â  Â  Â  Â  "Higiene Personal": [â€¨Â  Â  Â  Â  Â  Â  "Aromatizante", "Bolsas para basura", "Cepillo dental", "Cortina para baÃ±o", "Cloro",â€¨Â  Â  Â  Â  Â  Â  "Desengrasante", "Desodorante", "Fabuloso", "Esponja para trastes", "Gel", "Guantes",â€¨Â  Â  Â  Â  Â  Â  "JabÃ³n en polvo", "JabÃ³n para baÃ±o", "JabÃ³n para manos", "JabÃ³n para ropa", "JabÃ³n para trastes",â€¨Â  Â  Â  Â  Â  Â  "JabÃ³n zote", "Magitel", "Papel de baÃ±o", "Pasta de dientes", "Pastillas para baÃ±o",â€¨Â  Â  Â  Â  Â  Â  "Pastillas para taza", "Pinol", "Plantillas", "Raidolitos", "Rastrillos", "shampoo",â€¨Â  Â  Â  Â  Â  Â  "Sponja para baÃ±arse", "Suavizante", "Talco", "Toallas sanitarias"â€¨Â  Â  Â  Â  ],â€¨Â  Â  Â  Â  "Carnes": [â€¨Â  Â  Â  Â  Â  Â  "Carne molida", "Bistec", "Pechuga", "Higado", "Pescado", "Flecha", "Costilla", "Desherbada",â€¨Â  Â  Â  Â  Â  Â  "Pollo", "Tocino", "Carne para hamburguesas", "Alitas", "Puerco", "Flautas congeladas",â€¨Â  Â  Â  Â  Â  Â  "JamÃ³n", "Salchicha", "Chorizo"â€¨Â  Â  Â  Â  ],â€¨Â  Â  Â  Â  "Otros": ["Otros"]â€¨Â  Â  };â€¨â€¨Â  Â  // Funciones de utilidad para fechasâ€¨Â  Â  function inicioSemanaJueves(fecha) {â€¨Â  Â  Â  const d = new Date(fecha);â€¨Â  Â  Â  d.setHours(0,0,0,0);â€¨Â  Â  Â  const day = d.getDay();â€¨Â  Â  Â  const diff = (day - 4 + 7) % 7;â€¨Â  Â  Â  d.setDate(d.getDate() - diff);â€¨Â  Â  Â  return d;â€¨Â  Â  }â€¨Â  Â  function finSemanaDesdeInicio(inicio) {â€¨Â  Â  Â  const end = new Date(inicio);â€¨Â  Â  Â  end.setDate(end.getDate() + 6);â€¨Â  Â  Â  end.setHours(23,59,59,999);â€¨Â  Â  Â  return end;â€¨Â  Â  }â€¨Â  Â  function rangoSemanaTexto(inicio) {â€¨Â  Â  Â  const fin = finSemanaDesdeInicio(inicio);â€¨Â  Â  Â  return `Semana: Jue ${inicio.getDate()} ${mesesCortos[inicio.getMonth()]} ${inicio.getFullYear()} â€” MiÃ© ${fin.getDate()} ${mesesCortos[fin.getMonth()]} ${fin.getFullYear()}`;â€¨Â  Â  }â€¨Â  Â  function fechaDisplay(tipo, dateObj = new Date()) {â€¨Â  Â  Â  const dd = String(dateObj.getDate()).padStart(2,"0");â€¨Â  Â  Â  const mm = String(dateObj.getMonth()+1).padStart(2,"0");â€¨Â  Â  Â  const yyyy = dateObj.getFullYear();â€¨Â  Â  Â  if (tipo === "Sueldo") return `${dd}/${mm}/${yyyy}`;â€¨Â  Â  Â  const hh = String(dateObj.getHours()).padStart(2,"0");â€¨Â  Â  Â  const min = String(dateObj.getMinutes()).padStart(2,"0");â€¨Â  Â  Â  return `${dd}/${mm}/${yyyy} ${hh}:${min}`;â€¨Â  Â  }â€¨Â  Â  function obtenerMesAno(timestamp) {â€¨Â  Â  Â  Â  const fecha = new Date(timestamp);â€¨Â  Â  Â  Â  return `${mesesLargos[fecha.getMonth()]} ${fecha.getFullYear()}`;â€¨Â  Â  }â€¨â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: GestiÃ³n del Estado y Persistencia (localStorage)â€¨Â  Â  // ====================================================================================â€¨Â  Â  const state = (() => {â€¨Â  Â  Â  const saved = JSON.parse(localStorage.getItem("finanzas") || "{}");â€¨Â  Â  Â  if (saved.registros) {â€¨Â  Â  Â  Â  saved.registros = saved.registros.map(r => {â€¨Â  Â  Â  Â  Â  Â  if (!r.id) {â€¨Â  Â  Â  Â  Â  Â  Â  Â  r.id = r.ts;â€¨Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  Â  Â  return r;â€¨Â  Â  Â  Â  });â€¨Â  Â  Â  }â€¨Â  Â  Â  return Object.assign({â€¨Â  Â  Â  Â  saldo: 0,â€¨Â  Â  Â  Â  ahorro: 0,â€¨Â  Â  Â  Â  gastos: 0,â€¨Â  Â  Â  Â  registros: [],â€¨Â  Â  Â  Â  mandadoTickets: [],â€¨Â  Â  Â  Â  deudas: [],â€¨Â  Â  Â  Â  ultimaCorte: nullâ€¨Â  Â  Â  }, saved);â€¨Â  Â  })();â€¨â€¨Â  Â  function persist() {â€¨Â  Â  Â  localStorage.setItem("finanzas", JSON.stringify(state));â€¨Â  Â  }â€¨â€¨Â  Â  function aplicarCortesPendientes() {â€¨Â  Â  Â  const hoy = new Date();â€¨Â  Â  Â  const ultimoJuevesHoy = inicioSemanaJueves(hoy);â€¨Â  Â  Â  if (!state.ultimaCorte) {â€¨Â  Â  Â  Â  state.ultimaCorte = ultimoJuevesHoy.toISOString();â€¨Â  Â  Â  Â  persist();â€¨Â  Â  Â  Â  return;â€¨Â  Â  Â  }â€¨Â  Â  Â  let corte = new Date(state.ultimaCorte);â€¨Â  Â  Â  while (inicioSemanaJueves(corte).getTime() < ultimoJuevesHoy.getTime()) {â€¨Â  Â  Â  Â  state.registros.push({ id: Date.now(), tipo:"CIERRE", monto:0, fecha:fechaDisplay("Otros", corte), ts:corte.getTime() });â€¨Â  Â  Â  Â  state.gastos = 0;â€¨Â  Â  Â  Â  corte.setDate(corte.getDate()+7);â€¨Â  Â  Â  }â€¨Â  Â  Â  state.ultimaCorte = ultimoJuevesHoy.toISOString();â€¨Â  Â  Â  persist();â€¨Â  Â  }â€¨â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: Referencias a elementos del DOMâ€¨Â  Â  // ====================================================================================â€¨Â  Â  const $saldo = document.getElementById("saldo");â€¨Â  Â  const $ahorro = document.getElementById("ahorro");â€¨Â  Â  const $gastos = document.getElementById("gastos");â€¨Â  Â  const $monto = document.getElementById("monto");â€¨Â  Â  const $tipoÂ  = document.getElementById("tipo");â€¨Â  Â  const $btnConfirmar = document.getElementById("btn-confirmar");â€¨Â  Â  const $btnHistorial = document.getElementById("btn-historial");â€¨Â  Â  const $btnMandado = document.getElementById("btn-mandado");â€¨Â  Â  const $btnDeudas = document.getElementById("btn-deudas");â€¨Â  Â  const $historial = document.getElementById("historial");â€¨Â  Â  const $contenedorSemanas = document.getElementById("contenedorSemanas");â€¨Â  Â  const $contenedorMeses = document.getElementById("contenedorMeses");â€¨Â  Â  const $notificacion = document.getElementById("notificacion");â€¨Â  Â  const $tabs = document.querySelectorAll('.tab');â€¨Â  Â  const $chartPieContainer = document.getElementById('chart-pie-container');â€¨Â  Â  const $chartLineContainer = document.getElementById('chart-line-container');â€¨Â  Â  const historialContentContainers = document.querySelectorAll('.historial-content');â€¨Â  Â  const $mainScreen = document.getElementById('main-screen');â€¨Â  Â  const $mainPanel = document.getElementById('main-panel');â€¨Â  Â  const $mandadoScreen = document.getElementById('mandado-screen');â€¨Â  Â  const $mandadoCategoria = document.getElementById('mandado-categoria');â€¨Â  Â  const $mandadoProducto = document.getElementById('mandado-producto');â€¨Â  Â  const $nombreArticulo = document.getElementById('nombre-articulo');â€¨Â  Â  const $mandadoPeso = document.getElementById('mandado-peso');â€¨Â  Â  const $mandadoPrecio = document.getElementById('mandado-precio');â€¨Â  Â  const $btnAgregarArticulo = document.getElementById('btn-agregar-articulo');â€¨Â  Â  const $listaMandado = document.getElementById('lista-mandado');â€¨Â  Â  const $totalTicket = document.getElementById('total-ticket');â€¨Â  Â  const $btnGuardarTicket = document.getElementById('btn-guardar-ticket');â€¨Â  Â  const $btnVolverMandado = document.getElementById('btn-volver-mandado');â€¨Â  Â  const $btnHistorialMandado = document.getElementById('btn-historial-mandado');â€¨Â  Â  const $mandadoHistorialScreen = document.getElementById('mandado-historial-screen');â€¨Â  Â  const $btnVolverHistorial = document.getElementById('btn-volver-historial');â€¨Â  Â  const $mandadoHistorialLista = document.getElementById('mandado-historial-lista');â€¨Â  Â  const $mandadoDetalleScreen = document.getElementById('mandado-detalle-screen');â€¨Â  Â  const $btnVolverDetalle = document.getElementById('btn-volver-detalle');â€¨Â  Â  const $mandadoDetalleLista = document.getElementById('mandado-detalle-lista');â€¨Â  Â  const $detalleTitulo = document.getElementById('detalle-titulo');â€¨Â  Â  const $detalleTotal = document.getElementById('detalle-total');â€¨Â  Â  const $themeSwitcher = document.getElementById('theme-switcher');â€¨Â  Â  const $deudasScreen = document.getElementById('deudas-screen');â€¨Â  Â  const $deudasLista = document.getElementById('deudas-lista');â€¨Â  Â  const $btnVolverDeudas = document.getElementById('btn-volver-deudas');â€¨Â  Â  const $btnAgregarDeuda = document.getElementById('btn-agregar-deuda');â€¨Â  Â  const $modalDeuda = document.getElementById('modal-deuda');â€¨Â  Â  const $modalTitulo = document.getElementById('modal-titulo');â€¨Â  Â  const $deudaNombre = document.getElementById('deuda-nombre');â€¨Â  Â  const $deudaMontoTotal = document.getElementById('deuda-monto-total');â€¨Â  Â  const $deudaMontoPago = document.getElementById('deuda-monto-pago');â€¨Â  Â  const $btnGuardarDeuda = document.getElementById('btn-guardar-deuda');â€¨Â  Â  const $btnCerrarModal = document.getElementById('btn-cerrar-modal');â€¨â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: Funciones de Interfaz de Usuario (UI)â€¨Â  Â  // ====================================================================================â€¨Â  Â  function mostrarNotificacion(mensaje, tipo = 'exito') {â€¨Â  Â  Â  Â  $notificacion.textContent = mensaje;â€¨Â  Â  Â  Â  $notificacion.style.backgroundColor = (tipo === 'exito') ? 'var(--primary-btn-bg)' : 'var(--accent-red)';â€¨Â  Â  Â  Â  $notificacion.style.display = "block";â€¨Â  Â  Â  Â  setTimeout(() => {â€¨Â  Â  Â  Â  Â  Â  $notificacion.style.display = "none";â€¨Â  Â  Â  Â  }, 2500);â€¨Â  Â  }â€¨â€¨Â  Â  function renderResumen() {â€¨Â  Â  Â  $saldo.textContentÂ  = fmt.format(state.saldo);â€¨Â  Â  Â  $ahorro.textContent = fmt.format(state.ahorro);â€¨Â  Â  Â  $gastos.textContent = fmt.format(state.gastos);â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function mostrarPantalla(id) {â€¨Â  Â  Â  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));â€¨Â  Â  Â  document.getElementById(id).classList.add('active');â€¨Â  Â  Â  â€¨Â  Â  Â  if (id === 'main-screen') {â€¨Â  Â  Â  Â  $mainPanel.classList.remove('hidden');â€¨Â  Â  Â  } else {â€¨Â  Â  Â  Â  $mainPanel.classList.add('hidden');â€¨Â  Â  Â  }â€¨Â  Â  }â€¨â€¨Â  Â  function toggleTheme() {â€¨Â  Â  Â  Â  const currentTheme = document.documentElement.getAttribute("data-theme");â€¨Â  Â  Â  Â  const newTheme = currentTheme === "dark" ? "light" : "dark";â€¨Â  Â  Â  Â  document.documentElement.setAttribute("data-theme", newTheme);â€¨Â  Â  Â  Â  localStorage.setItem("theme", newTheme);â€¨Â  Â  Â  Â  $themeSwitcher.textContent = newTheme === "dark" ? "â˜€ï¸" : "ğŸŒ™";â€¨Â  Â  }â€¨â€¨Â  Â  function applySavedTheme() {â€¨Â  Â  Â  Â  const savedTheme = localStorage.getItem("theme") || "dark";â€¨Â  Â  Â  Â  document.documentElement.setAttribute("data-theme", savedTheme);â€¨Â  Â  Â  Â  $themeSwitcher.textContent = savedTheme === "dark" ? "â˜€ï¸" : "ğŸŒ™";â€¨Â  Â  }â€¨â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: LÃ³gica de Registro de Transaccionesâ€¨Â  Â  // ====================================================================================â€¨Â  Â  function agregarRegistro(tipo, monto, id = null) {â€¨Â  Â  Â  if (isNaN(monto) || monto === 0) {â€¨Â  Â  Â  Â  mostrarNotificacion("â— Monto invÃ¡lido", 'error');â€¨Â  Â  Â  Â  return;â€¨Â  Â  Â  }â€¨Â  Â  Â  const now = new Date();â€¨Â  Â  Â  const registro = {â€¨Â  Â  Â  Â  Â  id: id || now.getTime(),â€¨Â  Â  Â  Â  Â  tipo,â€¨Â  Â  Â  Â  Â  monto,â€¨Â  Â  Â  Â  Â  fecha: fechaDisplay(tipo, now),â€¨Â  Â  Â  Â  Â  ts: now.getTime()â€¨Â  Â  Â  };â€¨â€¨Â  Â  Â  if (tipo === "Sueldo") {â€¨Â  Â  Â  Â  state.saldo += monto;â€¨Â  Â  Â  } else if (tipo === "Ahorro") {â€¨Â  Â  Â  Â  if (monto < 0) {â€¨Â  Â  Â  Â  Â  state.ahorro += monto;â€¨Â  Â  Â  Â  Â  state.saldo += Math.abs(monto);â€¨Â  Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  state.ahorro += monto;â€¨Â  Â  Â  Â  Â  state.saldo -= monto;â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  } else {â€¨Â  Â  Â  Â  state.gastos += monto;â€¨Â  Â  Â  Â  state.saldo -= monto;â€¨Â  Â  Â  }â€¨Â  Â  Â  â€¨Â  Â  Â  // Manejar pagos a deudasâ€¨Â  Â  Â  if (tipo === "PrÃ©stamo" || tipo === "Coppel") {â€¨Â  Â  Â  Â  Â  // El monto ya fue restado de saldo en la lÃ³gica anterior, aquÃ­ solo lo asociamosâ€¨Â  Â  Â  Â  Â  // a la deuda, la cual se maneja en su propia funciÃ³n.â€¨Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  state.registros.push(registro);â€¨Â  Â  Â  }â€¨â€¨Â  Â  Â  persist();â€¨Â  Â  Â  renderResumen();â€¨Â  Â  Â  mostrarNotificacion("âœ… TransacciÃ³n registrada");â€¨Â  Â  Â  renderHistorial();â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function eliminarRegistro(id) {â€¨Â  Â  Â  Â  if (!confirm('Â¿EstÃ¡s seguro de que quieres eliminar este registro?')) {â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  const index = state.registros.findIndex(r => r.id == id);â€¨Â  Â  Â  Â  if (index === -1) {â€¨Â  Â  Â  Â  Â  Â  mostrarNotificacion("âŒ Registro no encontrado", 'error');â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  const registro = state.registros[index];â€¨Â  Â  Â  Â  const { tipo, monto } = registro;â€¨â€¨Â  Â  Â  Â  if (tipo === "Sueldo") {â€¨Â  Â  Â  Â  Â  Â  state.saldo -= monto;â€¨Â  Â  Â  Â  } else if (tipo === "Ahorro") {â€¨Â  Â  Â  Â  Â  Â  if (monto < 0) {â€¨Â  Â  Â  Â  Â  Â  Â  Â  state.ahorro -= monto;â€¨Â  Â  Â  Â  Â  Â  Â  Â  state.saldo -= Math.abs(monto);â€¨Â  Â  Â  Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  Â  Â  Â  state.ahorro -= monto;â€¨Â  Â  Â  Â  Â  Â  Â  Â  state.saldo += monto;â€¨Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  Â  state.gastos -= monto;â€¨Â  Â  Â  Â  Â  Â  state.saldo += monto;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  state.registros.splice(index, 1);â€¨Â  Â  Â  Â  persist();â€¨Â  Â  Â  Â  renderResumen();â€¨Â  Â  Â  Â  renderHistorial();â€¨Â  Â  Â  Â  mostrarNotificacion("ğŸ—‘ï¸ Registro eliminado");â€¨Â  Â  }â€¨â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: LÃ³gica y Renderizado del Historialâ€¨Â  Â  // ====================================================================================â€¨Â  Â  function obtenerIconoTipo(tipo) {â€¨Â  Â  Â  Â  const gastos = ["Mandado", "Efectivo", "Telmex", "CFE", "Tienda", "Corning", "Didi", "iCloud", "Coppel", "Otros", "PrÃ©stamo"];â€¨Â  Â  Â  Â  if (tipo === "Sueldo") return "ğŸŸ¢";â€¨Â  Â  Â  Â  if (tipo === "Ahorro") return "ğŸŸ¡";â€¨Â  Â  Â  Â  if (gastos.includes(tipo)) return "ğŸ”´";â€¨Â  Â  Â  Â  return "";â€¨Â  Â  }â€¨â€¨Â  Â  function crearRegistroHTML(registro) {â€¨Â  Â  Â  Â  const div = document.createElement("div");â€¨Â  Â  Â  Â  div.className = "registro";â€¨Â  Â  Â  Â  const icono = obtenerIconoTipo(registro.tipo);â€¨Â  Â  Â  Â  div.innerHTML = `<div class="tipo"><span class="icono">${icono}</span>${registro.tipo}</div><div class="monto">${fmt.format(registro.monto)}</div><button class="delete-btn" data-id="${registro.id}">âœ–ï¸</button><div class="fecha">${registro.fecha}</div>`;â€¨Â  Â  Â  Â  return div;â€¨Â  Â  }â€¨â€¨Â  Â  function agruparPorSemana() {â€¨Â  Â  Â  const grupos = new Map();â€¨Â  Â  Â  for (const r of state.registros) {â€¨Â  Â  Â  Â  const inicio = inicioSemanaJueves(r.ts);â€¨Â  Â  Â  Â  const key = inicio.toISOString();â€¨Â  Â  Â  Â  if (!grupos.has(key)) grupos.set(key, { inicio, items: [] });â€¨Â  Â  Â  Â  grupos.get(key).items.push(r);â€¨Â  Â  Â  }â€¨Â  Â  Â  return Array.from(grupos.values()).sort((a,b) => b.inicio - a.inicio);â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function agruparPorMes() {â€¨Â  Â  Â  Â  const grupos = new Map();â€¨Â  Â  Â  Â  for (const r of state.registros) {â€¨Â  Â  Â  Â  Â  Â  const mesAno = obtenerMesAno(r.ts);â€¨Â  Â  Â  Â  Â  Â  if (!grupos.has(mesAno)) grupos.set(mesAno, { nombre: mesAno, items: [] });â€¨Â  Â  Â  Â  Â  Â  grupos.get(mesAno).items.push(r);â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  Â  return Array.from(grupos.values()).sort((a, b) => b.items[0].ts - a.items[0].ts);â€¨Â  Â  }â€¨â€¨Â  Â  function renderHistorial() {â€¨Â  Â  Â  $contenedorSemanas.innerHTML = "";â€¨Â  Â  Â  const gruposSemanas = agruparPorSemana();â€¨Â  Â  Â  for (const g of gruposSemanas) {â€¨Â  Â  Â  Â  const divSemana = document.createElement("div");â€¨Â  Â  Â  Â  divSemana.className = "semana";â€¨Â  Â  Â  Â  const rango = document.createElement("div");â€¨Â  Â  Â  Â  rango.className = "rango";â€¨Â  Â  Â  Â  rango.textContent = rangoSemanaTexto(g.inicio);â€¨Â  Â  Â  Â  divSemana.appendChild(rango);â€¨â€¨Â  Â  Â  Â  g.items.sort((a,b)=>b.ts-a.ts).forEach(r => {â€¨Â  Â  Â  Â  Â  const registroEl = crearRegistroHTML(r);â€¨Â  Â  Â  Â  Â  divSemana.appendChild(registroEl);â€¨Â  Â  Â  Â  });â€¨Â  Â  Â  Â  $contenedorSemanas.appendChild(divSemana);â€¨Â  Â  Â  }â€¨â€¨Â  Â  Â  $contenedorMeses.innerHTML = "";â€¨Â  Â  Â  const gruposMeses = agruparPorMes();â€¨Â  Â  Â  for (const g of gruposMeses) {â€¨Â  Â  Â  Â  Â  const divMes = document.createElement("div");â€¨Â  Â  Â  Â  Â  divMes.className = "mes";â€¨Â  Â  Â  Â  Â  const rango = document.createElement("div");â€¨Â  Â  Â  Â  Â  rango.className = "rango";â€¨Â  Â  Â  Â  Â  rango.textContent = g.nombre;â€¨Â  Â  Â  Â  Â  divMes.appendChild(rango);â€¨â€¨Â  Â  Â  Â  Â  g.items.sort((a,b)=>b.ts-a.ts).forEach(r => {â€¨Â  Â  Â  Â  Â  Â  Â  const registroEl = crearRegistroHTML(r);â€¨Â  Â  Â  Â  Â  Â  Â  divMes.appendChild(registroEl);â€¨Â  Â  Â  Â  Â  });â€¨Â  Â  Â  Â  Â  $contenedorMeses.appendChild(divMes);â€¨Â  Â  Â  }â€¨Â  Â  Â  â€¨Â  Â  Â  document.querySelectorAll('.delete-btn').forEach(btn => {â€¨Â  Â  Â  Â  Â  btn.addEventListener('click', (e) => eliminarRegistro(e.currentTarget.dataset.id));â€¨Â  Â  Â  });â€¨Â  Â  }â€¨â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: LÃ³gica y Renderizado de GrÃ¡ficos (Circular y de LÃ­neas)â€¨Â  Â  // ====================================================================================â€¨Â  Â  function renderChartPie() {â€¨Â  Â  Â  const gastos = state.registros.filter(r => {â€¨Â  Â  Â  Â  const tipoGastos = ["Mandado", "Efectivo", "Telmex", "CFE", "Tienda", "Corning", "Didi", "iCloud", "Coppel", "Otros", "PrÃ©stamo"];â€¨Â  Â  Â  Â  return tipoGastos.includes(r.tipo);â€¨Â  Â  Â  });â€¨Â  Â  Â  â€¨Â  Â  Â  const gastosPorCategoria = gastos.reduce((acc, curr) => {â€¨Â  Â  Â  Â  acc[curr.tipo] = (acc[curr.tipo] || 0) + curr.monto;â€¨Â  Â  Â  Â  return acc;â€¨Â  Â  Â  }, {});â€¨Â  Â  Â  â€¨Â  Â  Â  const labels = Object.keys(gastosPorCategoria);â€¨Â  Â  Â  const data = Object.values(gastosPorCategoria);â€¨Â  Â  Â  â€¨Â  Â  Â  if (myChartPie) myChartPie.destroy();â€¨Â  Â  Â  â€¨Â  Â  Â  const ctx = document.getElementById('chart-pie').getContext('2d');â€¨Â  Â  Â  myChartPie = new Chart(ctx, {â€¨Â  Â  Â  Â  type: 'pie',â€¨Â  Â  Â  Â  data: {â€¨Â  Â  Â  Â  Â  labels: labels,â€¨Â  Â  Â  Â  Â  datasets: [{â€¨Â  Â  Â  Â  Â  Â  data: data,â€¨Â  Â  Â  Â  Â  Â  backgroundColor: [â€¨Â  Â  Â  Â  Â  Â  Â  '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',â€¨Â  Â  Â  Â  Â  Â  Â  '#FF9F40', '#E7E9ED', '#A0522D', '#20B2AA', '#778899', '#D2691E', '#CD5C5C'â€¨Â  Â  Â  Â  Â  Â  ],â€¨Â  Â  Â  Â  Â  Â  hoverOffset: 4â€¨Â  Â  Â  Â  Â  }]â€¨Â  Â  Â  Â  },â€¨Â  Â  Â  Â  options: {â€¨Â  Â  Â  Â  Â  responsive: true,â€¨Â  Â  Â  Â  Â  plugins: {â€¨Â  Â  Â  Â  Â  Â  legend: {â€¨Â  Â  Â  Â  Â  Â  Â  position: 'right',â€¨Â  Â  Â  Â  Â  Â  Â  labels: { color: getComputedStyle(document.body).getPropertyValue('--text-light') }â€¨Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  });â€¨Â  Â  }â€¨â€¨Â  Â  function renderChartLine() {â€¨Â  Â  Â  Â  const gastos = state.registros.filter(r => {â€¨Â  Â  Â  Â  Â  Â  const tipoGastos = ["Mandado", "Efectivo", "Telmex", "CFE", "Tienda", "Corning", "Didi", "iCloud", "Coppel", "Otros", "PrÃ©stamo"];â€¨Â  Â  Â  Â  Â  Â  return tipoGastos.includes(r.tipo);â€¨Â  Â  Â  Â  }).sort((a, b) => a.ts - b.ts);â€¨â€¨Â  Â  Â  Â  const gastosPorSemana = gastos.reduce((acc, curr) => {â€¨Â  Â  Â  Â  Â  Â  const semanaInicio = inicioSemanaJueves(curr.ts).toISOString();â€¨Â  Â  Â  Â  Â  Â  if (!acc[semanaInicio]) {â€¨Â  Â  Â  Â  Â  Â  Â  Â  acc[semanaInicio] = {â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: semanaInicio,â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  total: 0â€¨Â  Â  Â  Â  Â  Â  Â  Â  };â€¨Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  Â  Â  acc[semanaInicio].total += curr.monto;â€¨Â  Â  Â  Â  Â  Â  return acc;â€¨Â  Â  Â  Â  }, {});â€¨â€¨Â  Â  Â  Â  const labels = Object.values(gastosPorSemana).map(g => {â€¨Â  Â  Â  Â  Â  Â  const date = new Date(g.date);â€¨Â  Â  Â  Â  Â  Â  return `${date.getDate()} ${mesesCortos[date.getMonth()]}`;â€¨Â  Â  Â  Â  });â€¨Â  Â  Â  Â  const data = Object.values(gastosPorSemana).map(g => g.total);â€¨â€¨Â  Â  Â  Â  if (myChartLine) myChartLine.destroy();â€¨â€¨Â  Â  Â  Â  const ctx = document.getElementById('chart-line').getContext('2d');â€¨Â  Â  Â  Â  myChartLine = new Chart(ctx, {â€¨Â  Â  Â  Â  Â  Â  type: 'line',â€¨Â  Â  Â  Â  Â  Â  data: {â€¨Â  Â  Â  Â  Â  Â  Â  Â  labels: labels,â€¨Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: 'Gastos Semanales',â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: data,â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: 'var(--accent-red)',â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tension: 0.3,â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fill: true,â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(239, 83, 80, 0.2)',â€¨Â  Â  Â  Â  Â  Â  Â  Â  }]â€¨Â  Â  Â  Â  Â  Â  },â€¨Â  Â  Â  Â  Â  Â  options: {â€¨Â  Â  Â  Â  Â  Â  Â  Â  responsive: true,â€¨Â  Â  Â  Â  Â  Â  Â  Â  plugins: {â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  legend: {â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: { color: getComputedStyle(document.body).getPropertyValue('--text-light') }â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  Â  Â  Â  Â  },â€¨Â  Â  Â  Â  Â  Â  Â  Â  scales: {â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  x: {â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ticks: { color: 'var(--text-light)' },â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid: { color: 'var(--border-soft)' }â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y: {â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  beginAtZero: true,â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ticks: { color: 'var(--text-light)' },â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid: { color: 'var(--border-soft)' }â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  });â€¨Â  Â  }â€¨â€¨Â  Â  function toggleHistorial() {â€¨Â  Â  Â  if ($historial.style.display === "block") {â€¨Â  Â  Â  Â  $historial.style.display = "none";â€¨Â  Â  Â  } else {â€¨Â  Â  Â  Â  $historial.style.display = "block";â€¨Â  Â  Â  Â  handleTabClick({ currentTarget: document.querySelector('.tab.active') });â€¨Â  Â  Â  }â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function handleTabClick(event) {â€¨Â  Â  Â  Â  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));â€¨Â  Â  Â  Â  event.currentTarget.classList.add('active');â€¨Â  Â  Â  Â  const view = event.currentTarget.dataset.view;â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  historialContentContainers.forEach(c => c.style.display = 'none');â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  if (view === 'semana') {â€¨Â  Â  Â  Â  Â  Â  $contenedorSemanas.style.display = 'block';â€¨Â  Â  Â  Â  Â  Â  renderHistorial();â€¨Â  Â  Â  Â  } else if (view === 'mes') {â€¨Â  Â  Â  Â  Â  Â  $contenedorMeses.style.display = 'block';â€¨Â  Â  Â  Â  Â  Â  renderHistorial();â€¨Â  Â  Â  Â  } else if (view === 'analisis-gastos') {â€¨Â  Â  Â  Â  Â  Â  $chartPieContainer.style.display = 'block';â€¨Â  Â  Â  Â  Â  Â  renderChartPie();â€¨Â  Â  Â  Â  } else if (view === 'analisis-tendencia') {â€¨Â  Â  Â  Â  Â  Â  $chartLineContainer.style.display = 'block';â€¨Â  Â  Â  Â  Â  Â  renderChartLine();â€¨Â  Â  Â  Â  }â€¨Â  Â  }â€¨â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: LÃ³gica y Renderizado de Mandadoâ€¨Â  Â  // ====================================================================================â€¨Â  Â  function mostrarPantallaMandado() {â€¨Â  Â  Â  Â  mostrarPantalla('mandado-screen');â€¨Â  Â  Â  Â  limpiarFormularioMandado();â€¨Â  Â  }â€¨Â  Â  function limpiarFormularioMandado() {â€¨Â  Â  Â  Â  mandadoTicket = { items: [], total: 0 };â€¨Â  Â  Â  Â  editIndex = null;â€¨Â  Â  Â  Â  renderMandadoList();â€¨Â  Â  Â  Â  $mandadoCategoria.value = '';â€¨Â  Â  Â  Â  $mandadoProducto.style.display = 'none';â€¨Â  Â  Â  Â  $nombreArticulo.style.display = 'none';â€¨Â  Â  Â  Â  $mandadoPeso.style.display = 'none';â€¨Â  Â  Â  Â  $mandadoPrecio.style.display = 'none';â€¨Â  Â  Â  Â  $btnAgregarArticulo.style.display = 'none';â€¨Â  Â  Â  Â  $btnAgregarArticulo.textContent = "â• Agregar";â€¨Â  Â  }â€¨â€¨Â  Â  function actualizarProductosDropdown() {â€¨Â  Â  Â  Â  const categoria = $mandadoCategoria.value;â€¨Â  Â  Â  Â  const productos = productosMandado[categoria] || [];â€¨Â  Â  Â  Â  $mandadoProducto.innerHTML = `<option value="">Selecciona Producto</option>`;â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  if (categoria) {â€¨Â  Â  Â  Â  Â  Â  productos.sort().forEach(p => {â€¨Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');â€¨Â  Â  Â  Â  Â  Â  Â  Â  option.value = p;â€¨Â  Â  Â  Â  Â  Â  Â  Â  option.textContent = p;â€¨Â  Â  Â  Â  Â  Â  Â  Â  $mandadoProducto.appendChild(option);â€¨Â  Â  Â  Â  Â  Â  });â€¨Â  Â  Â  Â  Â  Â  $mandadoProducto.style.display = (categoria === 'Otros') ? 'none' : 'block';â€¨Â  Â  Â  Â  Â  Â  $nombreArticulo.style.display = (categoria === 'Otros') ? 'block' : 'none';â€¨Â  Â  Â  Â  Â  Â  $mandadoPeso.style.display = (categoria === 'Frutas y Verduras') ? 'block' : 'none';â€¨Â  Â  Â  Â  Â  Â  $mandadoPrecio.style.display = 'block';â€¨Â  Â  Â  Â  Â  Â  $btnAgregarArticulo.style.display = 'block';â€¨Â  Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  Â  $mandadoProducto.style.display = 'none';â€¨Â  Â  Â  Â  Â  Â  $nombreArticulo.style.display = 'none';â€¨Â  Â  Â  Â  Â  Â  $mandadoPeso.style.display = 'none';â€¨Â  Â  Â  Â  Â  Â  $mandadoPrecio.style.display = 'none';â€¨Â  Â  Â  Â  Â  Â  $btnAgregarArticulo.style.display = 'none';â€¨Â  Â  Â  Â  }â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function agregarArticulo() {â€¨Â  Â  Â  Â  const categoria = $mandadoCategoria.value;â€¨Â  Â  Â  Â  let nombre = '';â€¨Â  Â  Â  Â  let monto = 0;â€¨Â  Â  Â  Â  let cantidad = 0;â€¨Â  Â  Â  Â  let unidad = '';â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  if (categoria === 'Otros') {â€¨Â  Â  Â  Â  Â  Â  nombre = $nombreArticulo.value.trim();â€¨Â  Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  Â  nombre = $mandadoProducto.value;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  if (!nombre) {â€¨Â  Â  Â  Â  Â  Â  mostrarNotificacion("â— Selecciona un producto", 'error');â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  if (categoria === "Frutas y Verduras") {â€¨Â  Â  Â  Â  Â  Â  const peso = parseFloat($mandadoPeso.value);â€¨Â  Â  Â  Â  Â  Â  const precio = parseFloat($mandadoPrecio.value);â€¨Â  Â  Â  Â  Â  Â  if (isNaN(peso) || isNaN(precio) || peso <= 0 || precio <= 0) {â€¨Â  Â  Â  Â  Â  Â  Â  Â  mostrarNotificacion("â— Ingresa peso y precio vÃ¡lidos", 'error');â€¨Â  Â  Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  Â  Â  monto = peso * precio;â€¨Â  Â  Â  Â  Â  Â  cantidad = peso;â€¨Â  Â  Â  Â  Â  Â  unidad = "kg";â€¨Â  Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  Â  const precio = parseFloat($mandadoPrecio.value);â€¨Â  Â  Â  Â  Â  Â  if (isNaN(precio) || precio <= 0) {â€¨Â  Â  Â  Â  Â  Â  Â  Â  mostrarNotificacion("â— Ingresa un precio vÃ¡lido", 'error');â€¨Â  Â  Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  Â  Â  }â€¨Â  Â  Â  Â  Â  Â  monto = precio;â€¨Â  Â  Â  Â  Â  Â  cantidad = 1;â€¨Â  Â  Â  Â  Â  Â  unidad = "pz";â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  const articulo = { nombre, monto, cantidad, unidad, categoria };â€¨â€¨Â  Â  Â  Â  if (editIndex !== null) {â€¨Â  Â  Â  Â  Â  Â  mandadoTicket.total -= mandadoTicket.items[editIndex].monto;â€¨Â  Â  Â  Â  Â  Â  mandadoTicket.items[editIndex] = articulo;â€¨Â  Â  Â  Â  Â  Â  mandadoTicket.total += articulo.monto;â€¨Â  Â  Â  Â  Â  Â  editIndex = null;â€¨Â  Â  Â  Â  Â  Â  $btnAgregarArticulo.textContent = "â• Agregar";â€¨Â  Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  Â  mandadoTicket.items.push(articulo);â€¨Â  Â  Â  Â  Â  Â  mandadoTicket.total += articulo.monto;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  renderMandadoList();â€¨Â  Â  Â  Â  $mandadoCategoria.value = '';â€¨Â  Â  Â  Â  $mandadoProducto.style.display = 'none';â€¨Â  Â  Â  Â  $nombreArticulo.value = '';â€¨Â  Â  Â  Â  $nombreArticulo.style.display = 'none';â€¨Â  Â  Â  Â  $mandadoPeso.value = '';â€¨Â  Â  Â  Â  $mandadoPrecio.value = '';â€¨Â  Â  Â  Â  $mandadoPeso.style.display = 'none';â€¨Â  Â  Â  Â  $mandadoPrecio.style.display = 'none';â€¨Â  Â  Â  Â  $btnAgregarArticulo.style.display = 'none';â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function eliminarArticuloDelTicket(index) {â€¨Â  Â  Â  Â  if (index >= 0 && index < mandadoTicket.items.length) {â€¨Â  Â  Â  Â  Â  Â  const item = mandadoTicket.items[index];â€¨Â  Â  Â  Â  Â  Â  mandadoTicket.total -= item.monto;â€¨Â  Â  Â  Â  Â  Â  mandadoTicket.items.splice(index, 1);â€¨Â  Â  Â  Â  Â  Â  renderMandadoList();â€¨Â  Â  Â  Â  }â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function editarArticuloDelTicket(index) {â€¨Â  Â  Â  Â  const item = mandadoTicket.items[index];â€¨Â  Â  Â  Â  if (!item) return;â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  editIndex = index;â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  $mandadoCategoria.value = item.categoria;â€¨Â  Â  Â  Â  actualizarProductosDropdown();â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  if (item.categoria === "Otros") {â€¨Â  Â  Â  Â  Â  Â  $nombreArticulo.value = item.nombre;â€¨Â  Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  Â  $mandadoProducto.value = item.nombre;â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  if (item.unidad === "kg") {â€¨Â  Â  Â  Â  Â  Â  $mandadoPeso.value = item.cantidad;â€¨Â  Â  Â  Â  Â  Â  $mandadoPrecio.value = (item.monto / item.cantidad).toFixed(2);â€¨Â  Â  Â  Â  } else {â€¨Â  Â  Â  Â  Â  Â  $mandadoPrecio.value = item.monto;â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  $btnAgregarArticulo.textContent = "âœ… Actualizar";â€¨Â  Â  Â  Â  $mandadoPrecio.focus();â€¨Â  Â  }â€¨â€¨Â  Â  function renderMandadoList() {â€¨Â  Â  Â  Â  $listaMandado.innerHTML = '';â€¨Â  Â  Â  Â  mandadoTicket.items.forEach((item, index) => {â€¨Â  Â  Â  Â  Â  Â  const li = document.createElement('li');â€¨Â  Â  Â  Â  Â  Â  const cantidadDisplay = item.unidad === 'kg' ? `${item.cantidad} kg` : item.cantidad;â€¨Â  Â  Â  Â  Â  Â  li.innerHTML = `â€¨Â  Â  Â  Â  Â  Â  Â  Â  <span class="nombre">${item.nombre}</span>â€¨Â  Â  Â  Â  Â  Â  Â  Â  <span class="cantidad">${cantidadDisplay}</span>â€¨Â  Â  Â  Â  Â  Â  Â  Â  <span class="precio">${fmt.format(item.monto)}</span>â€¨Â  Â  Â  Â  Â  Â  Â  Â  <div class="actions">â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn secundario" onclick="editarArticuloDelTicket(${index})">âœï¸</button>â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn secundario" onclick="eliminarArticuloDelTicket(${index})">ğŸ—‘ï¸</button>â€¨Â  Â  Â  Â  Â  Â  Â  Â  </div>â€¨Â  Â  Â  Â  Â  Â  `;â€¨Â  Â  Â  Â  Â  Â  $listaMandado.appendChild(li);â€¨Â  Â  Â  Â  });â€¨Â  Â  Â  Â  $totalTicket.textContent = fmt.format(mandadoTicket.total);â€¨Â  Â  }â€¨â€¨Â  Â  function guardarTicket() {â€¨Â  Â  Â  Â  if (mandadoTicket.total <= 0) {â€¨Â  Â  Â  Â  Â  Â  mostrarNotificacion("â— No hay artÃ­culos para guardar", 'error');â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  const now = new Date();â€¨Â  Â  Â  Â  const ticketCompleto = {â€¨Â  Â  Â  Â  Â  Â  id: now.getTime(),â€¨Â  Â  Â  Â  Â  Â  fecha: fechaDisplay("Mandado", now),â€¨Â  Â  Â  Â  Â  Â  total: mandadoTicket.total,â€¨Â  Â  Â  Â  Â  Â  items: mandadoTicket.itemsâ€¨Â  Â  Â  Â  };â€¨Â  Â  Â  Â  state.mandadoTickets.push(ticketCompleto);â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  // Registrar el monto total del ticket en el historial principal como 'Mandado'â€¨Â  Â  Â  Â  agregarRegistro("Mandado", ticketCompleto.total, ticketCompleto.id);â€¨â€¨Â  Â  Â  Â  persist();â€¨Â  Â  Â  Â  mostrarNotificacion("âœ… Ticket guardado en el historial");â€¨Â  Â  Â  Â  mostrarPantalla('main-screen');â€¨Â  Â  }â€¨â€¨Â  Â  function mostrarHistorialMandados() {â€¨Â  Â  Â  Â  mostrarPantalla('mandado-historial-screen');â€¨Â  Â  Â  Â  $mandadoHistorialLista.innerHTML = '';â€¨Â  Â  Â  Â  state.mandadoTickets.sort((a, b) => b.id - a.id).forEach(ticket => {â€¨Â  Â  Â  Â  Â  Â  const li = document.createElement('li');â€¨Â  Â  Â  Â  Â  Â  li.innerHTML = `<span class="nombre">Ticket del ${ticket.fecha}</span><span class="precio">${fmt.format(ticket.total)}</span>`;â€¨Â  Â  Â  Â  Â  Â  li.dataset.id = ticket.id;â€¨Â  Â  Â  Â  Â  Â  li.addEventListener('click', () => mostrarDetalleMandado(ticket.id));â€¨Â  Â  Â  Â  Â  Â  $mandadoHistorialLista.appendChild(li);â€¨Â  Â  Â  Â  });â€¨Â  Â  }â€¨â€¨Â  Â  function mostrarDetalleMandado(id) {â€¨Â  Â  Â  Â  const ticket = state.mandadoTickets.find(t => t.id == id);â€¨Â  Â  Â  Â  if (!ticket) {â€¨Â  Â  Â  Â  Â  Â  mostrarNotificacion("Ticket no encontrado", "error");â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  mostrarPantalla('mandado-detalle-screen');â€¨Â  Â  Â  Â  $detalleTitulo.textContent = `Detalle del ticket (${ticket.fecha})`;â€¨Â  Â  Â  Â  $detalleTotal.textContent = fmt.format(ticket.total);â€¨Â  Â  Â  Â  $mandadoDetalleLista.innerHTML = '';â€¨Â  Â  Â  Â  ticket.items.forEach(item => {â€¨Â  Â  Â  Â  Â  Â  const li = document.createElement('li');â€¨Â  Â  Â  Â  Â  Â  const cantidadDisplay = item.unidad === 'kg' ? `${item.cantidad} kg` : item.cantidad;â€¨Â  Â  Â  Â  Â  Â  li.innerHTML = `<span class="nombre">${item.nombre}</span><span class="cantidad">${cantidadDisplay}</span><span class="precio">${fmt.format(item.monto)}</span>`;â€¨Â  Â  Â  Â  Â  Â  $mandadoDetalleLista.appendChild(li);â€¨Â  Â  Â  Â  });â€¨Â  Â  }â€¨â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: LÃ³gica y Renderizado de Deudasâ€¨Â  Â  // ====================================================================================â€¨Â  Â  function mostrarPantallaDeudas() {â€¨Â  Â  Â  Â  mostrarPantalla('deudas-screen');â€¨Â  Â  Â  Â  renderDeudas();â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function renderDeudas() {â€¨Â  Â  Â  Â  $deudasLista.innerHTML = '';â€¨Â  Â  Â  Â  if (state.deudas.length === 0) {â€¨Â  Â  Â  Â  Â  Â  $deudasLista.innerHTML = '<p style="text-align: center; color: var(--text-light);">No hay deudas registradas.</p>';â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  state.deudas.forEach(deuda => {â€¨Â  Â  Â  Â  Â  Â  const li = document.createElement('li');â€¨Â  Â  Â  Â  Â  Â  li.innerHTML = `â€¨Â  Â  Â  Â  Â  Â  Â  Â  <h3>${deuda.nombre}</h3>â€¨Â  Â  Â  Â  Â  Â  Â  Â  <div class="info">â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Monto total: <span class="monto-total">${fmt.format(deuda.montoTotal)}</span></span>â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Pagado: <span class="monto-pagado">${fmt.format(deuda.montoPagado)}</span></span>â€¨Â  Â  Â  Â  Â  Â  Â  Â  </div>â€¨Â  Â  Â  Â  Â  Â  Â  Â  <div class="info">â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Restante: <span class="monto-restante">${fmt.format(deuda.montoTotal - deuda.montoPagado)}</span></span>â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Fecha: ${deuda.fecha}</span>â€¨Â  Â  Â  Â  Â  Â  Â  Â  </div>â€¨Â  Â  Â  Â  Â  Â  Â  Â  <div class="deuda-actions">â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn" onclick="mostrarModalPago(${deuda.id})">Pagar</button>â€¨Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn secundario" onclick="eliminarDeuda(${deuda.id})">Eliminar</button>â€¨Â  Â  Â  Â  Â  Â  Â  Â  </div>â€¨Â  Â  Â  Â  Â  Â  `;â€¨Â  Â  Â  Â  Â  Â  $deudasLista.appendChild(li);â€¨Â  Â  Â  Â  });â€¨Â  Â  }â€¨â€¨Â  Â  let deudaSeleccionadaId = null;â€¨â€¨Â  Â  function mostrarModalDeuda(modo = 'agregar', deudaId = null) {â€¨Â  Â  Â  Â  $modalDeuda.style.display = 'block';â€¨Â  Â  Â  Â  deudaSeleccionadaId = deudaId;â€¨Â  Â  Â  Â  $deudaMontoPago.style.display = 'none';â€¨â€¨Â  Â  Â  Â  if (modo === 'agregar') {â€¨Â  Â  Â  Â  Â  Â  $modalTitulo.textContent = 'Agregar Nueva Deuda';â€¨Â  Â  Â  Â  Â  Â  $deudaNombre.value = '';â€¨Â  Â  Â  Â  Â  Â  $deudaMontoTotal.value = '';â€¨Â  Â  Â  Â  Â  Â  $deudaMontoTotal.placeholder = 'Monto total (ej. 5000)';â€¨Â  Â  Â  Â  } else { // 'pagar'â€¨Â  Â  Â  Â  Â  Â  const deuda = state.deudas.find(d => d.id === deudaId);â€¨Â  Â  Â  Â  Â  Â  $modalTitulo.textContent = `Pagar ${deuda.nombre}`;â€¨Â  Â  Â  Â  Â  Â  $deudaNombre.value = deuda.nombre;â€¨Â  Â  Â  Â  Â  Â  $deudaMontoTotal.value = deuda.montoTotal - deuda.montoPagado;â€¨Â  Â  Â  Â  Â  Â  $deudaMontoTotal.placeholder = 'Monto a abonar';â€¨Â  Â  Â  Â  Â  Â  $deudaNombre.disabled = true;â€¨Â  Â  Â  Â  }â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function mostrarModalPago(deudaId) {â€¨Â  Â  Â  Â  $modalDeuda.style.display = 'block';â€¨Â  Â  Â  Â  deudaSeleccionadaId = deudaId;â€¨Â  Â  Â  Â  const deuda = state.deudas.find(d => d.id === deudaId);â€¨Â  Â  Â  Â  if (!deuda) return;â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  $modalTitulo.textContent = `Pagar ${deuda.nombre}`;â€¨Â  Â  Â  Â  $deudaNombre.style.display = 'none';â€¨Â  Â  Â  Â  $deudaMontoTotal.style.display = 'none';â€¨Â  Â  Â  Â  $deudaMontoPago.style.display = 'block';â€¨Â  Â  Â  Â  $deudaMontoPago.value = '';â€¨Â  Â  Â  Â  $deudaMontoPago.placeholder = 'Monto del pago';â€¨Â  Â  Â  Â  $btnGuardarDeuda.onclick = () => procesarPagoDeuda(deudaId);â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function procesarPagoDeuda(deudaId) {â€¨Â  Â  Â  Â  const montoPago = parseFloat($deudaMontoPago.value);â€¨Â  Â  Â  Â  if (isNaN(montoPago) || montoPago <= 0) {â€¨Â  Â  Â  Â  Â  Â  mostrarNotificacion("â— Monto invÃ¡lido", 'error');â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  const deudaIndex = state.deudas.findIndex(d => d.id === deudaId);â€¨Â  Â  Â  Â  if (deudaIndex === -1) {â€¨Â  Â  Â  Â  Â  Â  mostrarNotificacion("âŒ Deuda no encontrada", 'error');â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨â€¨Â  Â  Â  Â  const deuda = state.deudas[deudaIndex];â€¨Â  Â  Â  Â  const restante = deuda.montoTotal - deuda.montoPagado;â€¨â€¨Â  Â  Â  Â  if (montoPago > restante) {â€¨Â  Â  Â  Â  Â  Â  mostrarNotificacion("â— El pago es mayor que el monto restante", 'error');â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  deuda.montoPagado += montoPago;â€¨Â  Â  Â  Â  deuda.fecha = fechaDisplay("Otros", new Date());â€¨â€¨Â  Â  Â  Â  // Registrar el pago en el historial principal como un gastoâ€¨Â  Â  Â  Â  agregarRegistro(deuda.nombre, montoPago);â€¨â€¨Â  Â  Â  Â  persist();â€¨Â  Â  Â  Â  renderDeudas();â€¨Â  Â  Â  Â  mostrarNotificacion(`âœ… Pago de ${fmt.format(montoPago)} registrado a ${deuda.nombre}.`);â€¨Â  Â  Â  Â  $modalDeuda.style.display = 'none';â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  // Re-renderizar el historial principal para mostrar el pagoâ€¨Â  Â  Â  Â  renderHistorial();â€¨Â  Â  }â€¨Â  Â  â€¨Â  Â  function guardarDeuda() {â€¨Â  Â  Â  Â  const nombre = $deudaNombre.value.trim();â€¨Â  Â  Â  Â  const montoTotal = parseFloat($deudaMontoTotal.value);â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  if (!nombre || isNaN(montoTotal) || montoTotal <= 0) {â€¨Â  Â  Â  Â  Â  Â  mostrarNotificacion("â— Ingresa un nombre y monto total vÃ¡lidos", 'error');â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  const nuevaDeuda = {â€¨Â  Â  Â  Â  Â  Â  id: Date.now(),â€¨Â  Â  Â  Â  Â  Â  nombre,â€¨Â  Â  Â  Â  Â  Â  montoTotal,â€¨Â  Â  Â  Â  Â  Â  montoPagado: 0,â€¨Â  Â  Â  Â  Â  Â  fecha: fechaDisplay("Otros", new Date())â€¨Â  Â  Â  Â  };â€¨Â  Â  Â  Â  â€¨Â  Â  Â  Â  state.deudas.push(nuevaDeuda);â€¨Â  Â  Â  Â  persist();â€¨Â  Â  Â  Â  renderDeudas();â€¨Â  Â  Â  Â  mostrarNotificacion("âœ… Deuda agregada con Ã©xito.");â€¨Â  Â  Â  Â  $modalDeuda.style.display = 'none';â€¨Â  Â  }â€¨â€¨Â  Â  function eliminarDeuda(id) {â€¨Â  Â  Â  Â  if (!confirm('Â¿EstÃ¡s seguro de que quieres eliminar esta deuda?')) {â€¨Â  Â  Â  Â  Â  Â  return;â€¨Â  Â  Â  Â  }â€¨Â  Â  Â  Â  state.deudas = state.deudas.filter(d => d.id !== id);â€¨Â  Â  Â  Â  persist();â€¨Â  Â  Â  Â  renderDeudas();â€¨Â  Â  Â  Â  mostrarNotificacion("ğŸ—‘ï¸ Deuda eliminada");â€¨Â  Â  }â€¨â€¨Â  Â  // ====================================================================================â€¨Â  Â  // INICIO: Event Listeners y LÃ³gica de Inicioâ€¨Â  Â  // ====================================================================================â€¨Â  Â  // PWA REGISTRATIONâ€¨Â  Â  if ('serviceWorker' in navigator) {â€¨Â  Â  Â  window.addEventListener('load', () => {â€¨Â  Â  Â  Â  navigator.serviceWorker.register('/sw.js').then(registration => {â€¨Â  Â  Â  Â  Â  console.log('Service Worker registrado con Ã©xito:', registration);â€¨Â  Â  Â  Â  }).catch(error => {â€¨Â  Â  Â  Â  Â  console.log('Fallo el registro del Service Worker:', error);â€¨Â  Â  Â  Â  });â€¨Â  Â  Â  });â€¨Â  Â  }â€¨â€¨Â  Â  // Event Listenersâ€¨Â  Â  applySavedTheme();â€¨Â  Â  aplicarCortesPendientes();â€¨Â  Â  renderResumen();â€¨Â  Â  renderDeudas();â€¨Â  Â  $btnConfirmar.addEventListener("click", () => agregarRegistro($tipo.value, parseFloat($monto.value)));â€¨Â  Â  $monto.addEventListener("keydown", e => { if (e.key === "Enter") agregarRegistro($tipo.value, parseFloat($monto.value)); });â€¨Â  Â  $btnHistorial.addEventListener("click", toggleHistorial);â€¨Â  Â  $tabs.forEach(tab => tab.addEventListener('click', handleTabClick));â€¨Â  Â  â€¨Â  Â  $btnMandado.addEventListener('click', mostrarPantallaMandado);â€¨Â  Â  $btnVolverMandado.addEventListener('click', () => mostrarPantalla('main-screen'));â€¨Â  Â  $mandadoCategoria.addEventListener('change', actualizarProductosDropdown);â€¨Â  Â  $btnAgregarArticulo.addEventListener('click', agregarArticulo);â€¨Â  Â  $btnGuardarTicket.addEventListener('click', guardarTicket);â€¨Â  Â  $btnHistorialMandado.addEventListener('click', mostrarHistorialMandados);â€¨Â  Â  $btnVolverHistorial.addEventListener('click', mostrarPantallaMandado);â€¨Â  Â  $btnVolverDetalle.addEventListener('click', mostrarHistorialMandados);â€¨Â  Â  $themeSwitcher.addEventListener('click', toggleTheme);â€¨Â  Â  â€¨Â  Â  // Eventos de Deudasâ€¨Â  Â  $btnDeudas.addEventListener('click', mostrarPantallaDeudas);â€¨Â  Â  $btnVolverDeudas.addEventListener('click', () => mostrarPantalla('main-screen'));â€¨Â  Â  $btnAgregarDeuda.addEventListener('click', () => {â€¨Â  Â  Â  Â  mostrarModalDeuda('agregar');â€¨Â  Â  Â  Â  $deudaNombre.style.display = 'block';â€¨Â  Â  Â  Â  $deudaMontoTotal.style.display = 'block';â€¨Â  Â  Â  Â  $btnGuardarDeuda.onclick = guardarDeuda;â€¨Â  Â  });â€¨Â  Â  $btnCerrarModal.addEventListener('click', () => $modalDeuda.style.display = 'none');â€¨Â  </script>â€¨</body>â€¨</html>